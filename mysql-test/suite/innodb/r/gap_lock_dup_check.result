CREATE TABLE t1 (a int not null, b int not null, primary key(a), unique key(b)) engine = innodb;
insert into t1 values (10,10), (20,20), (30,30), (40,40), (50,50), (60,60),
(70,70), (80,80), (90,90);
connect prevent_purge,localhost,root,,;
start transaction with consistent snapshot;
connection default;
delete from t1 where a between 30 and 80;
connect con1, localhost, root;
begin;
insert into t1 values (65,60);
connection default;
SET session innodb_lock_wait_timeout=1;
insert into t1 values (45,45);
ERROR HY000: Lock wait timeout exceeded; try restarting transaction
insert into t1 values (75,75);
ERROR HY000: Lock wait timeout exceeded; try restarting transaction
disconnect con1;
disconnect prevent_purge;
connection default;
drop table t1;
